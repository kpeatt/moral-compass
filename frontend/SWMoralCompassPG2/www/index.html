<!DOCTYPE html>
<html>
<!--
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#  KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#
-->
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name = "format-detection" content = "telephone=no"/>
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width;" />
        <link href="screen.css" media="screen" rel="stylesheet" type="text/css" />
        <title>MoralCode</title>
        <script type="text/javascript" src="cordova-2.0.0.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/jquery-1.7.2.js"></script>
        <script type="text/javascript" src="js/ScanditSDK.js"></script>
        <script type="text/javascript" src="js/moralcompass.js"></script>
        <script type="text/javascript" src="js/protovis.js"></script>

    </head>
    <body class="mc-container-home">
        
        <header id="mc-topbar" onclick='//debugToggleAndShowSummary();'>
	       <h1>MoralCode</h1>
           <div id="mc-container-search" class="searchbar" onClick="$('#search_text').focus();">
	       
	           <input id = "search_text" type="search" placeholder="Enter a company name">
	           <input id = "search_submit" type="submit" value="Search">
	       
	       </div>
	</header>
        
        <!-- home -->
        <div id="mc-container-home" class="home">
	   
            <div id="mc-content-home" class="content">
    	       
    	       <nav>
    	           <ul>
    	               <li>
                            <a href="#" id="mc-button-home-scan" class="button scan">
    	                       Scan a Product
    	                   </a>
    	               </li> 
    	               <li>
    	                   <a href="#" id="mc-button-home-quiz" class="button quiz">
    	                       Set your MoralCode
    	                   </a>
    	               </li>
    	               <li>
    	                   <a href="#" id="mc-button-home-search" class="button search">
    	                       Search for a Company
    	                   </a>
    	               </li>
    	           </ul>
    	           
    	       </nav>
    	       
    	   </div>
    	   
       </div>
        <!-- end home -->
        
        <!-- quiz -->
        <div id="mc-container-quiz" class="home">
            <div id="mc-content-quiz" class="content">
            
            <h1>Set your MoralCode</h1>
            
            <div id="mc-quiz-list">
            <div class="question">
            
               <h2>Same-sex marriage:</h2> 
               
               <ul class="choice">
                   <li>
                       <a href="#" class="button support" onClick="myStances.setStance(0, MCStance.yes()); myStances.save();">Support</a>
                   </li>
                   <li>
                       <a href="#" class="button dontcare" onClick="myStances.setStance(0, MCStance.donotcare()); myStances.save();">Don't care</a>
                   </li>
                   <li>
                       <a href="#" class="button oppose" onClick="myStances.setStance(0, MCStance.no()); myStances.save();">Oppose</a>
                   </li>
               </ul>
	           
	       </div>
	       
	       <div class="question">
	       
	           <h2>Testing on animals:</h2> 
	           <ul class="choice">
	               <li>
	                   <a href="#" class="button support" onClick="myStances.setStance(1, MCStance.yes()); myStances.save();">Support</a>
	               </li>
	               <li>
	                   <a href="#" class="button dontcare" onClick="myStances.setStance(1, MCStance.donotcate()); myStances.save();">Don't care</a>
	               </li>
	               <li>
	                   <a href="#" class="button oppose" onClick="myStances.setStance(1, MCStance.no()); myStances.save();">Oppose</a>
	               </li>
	           </ul>
	           
	       </div>
	       
	       <div class="question">
	       
	           <h2>Use of child labour:</h2> 
	           <ul class="choice">
	               <li>
	                   <a href="#" class="button support" onClick="myStances.setStance(2, MCStance.yes()); myStances.save();">Support</a>
	               </li>
	               <li>
	                   <a href="#" class="button dontcare" onClick="myStances.setStance(2, MCStance.donotcare()); myStances.save();">Don't care</a>
	               </li>
	               <li>
	                   <a href="#" class="button oppose" onClick="myStances.setStance(2, MCStance.no()); myStances.save();">Oppose</a>
	               </li>
	           </ul>
	           
	       </div>
	       
	       <div class="question">
	       
	           <h2>Government-set minimum wage:</h2> 
	           <ul class="choice">
	               <li>
	                   <a href="#" class="button support" onClick="myStances.setStance(3, MCStance.yes()); myStances.save();">Support</a>
	               </li>
	               <li>
	                   <a href="#" class="button dontcare" onClick="myStances.setStance(3, MCStance.donotcare()); myStances.save();">Don't care</a>
	               </li>
	               <li>
	                   <a href="#" class="button oppose" onClick="myStances.setStance(3, MCStance.no()); myStances.save();">Oppose</a>
	               </li>
	           </ul>
	           
	       </div>
            </div>
	   </div>
        </div>
        <!-- end quiz -->
        
        
        <div id="mc-container-summary" class="container">
            
            <div id="mc-support-indicator" class="cause-indicator">
                <span>Support</span>
            </div>
            
            <div id="mc-support-description" class="statement">Google and you are buddies.</div>
            <div class="card">
                <h2 id="mc-support-user-agree-text">You agree on <span id="mc-support-user-agree-text-percent">75%</span> 
                                                     of the same causes.
                </h2>
                
                <div class="chart bar">
                    <div class="data" id="mc-summary-chart-data"></div>
                </div>
                
                <div class="causes" id="mc-cause-list">
                    <ul>
                        <li class="agree">Same-Sex marriage</li>
                        <li class="agree">Testing on animals</li>
                        <li class="agree">Use of child labour</li>
                        <li class="disagree">Government-set minimum wage</li>
                    </ul>
                </div>
                
            </div>
            
            <div class="card minor">
                <div id="mc-support-other-indicator" class="chart agree"></div>
                <h2 id="mc-support-others-agree-text"><span id="mc-support-others-agree-text-percent">68%</span> of users
                                                     agree with this company.</div>
        </div>
            
        <!-- end summary -->
        
        <div id="mc-container-login" class="container">login!</div>
        <div id="mc-container-detail" class="container">detail!</div>
        <div id="mc-container-settings" class="container">
            <h1>Enter your account details</h1>
            <form>
                <input type="text" placeholder="Name">
                <input type="email" placeholder="Email">
                <label for="checkbox"><input type="checkbox" checked> Send me offers from companies that share my causes</label>
            </form>
            
            <a href="#" class="button compass">
                Reset my MoralCode 
            </a>
        </div>
        
        
        <!-- replace with images! -->
        <footer id="mc-bottom-bar" class="bottomnav">
	       <nav>
	           <ul>
	               <li><a href="#" id="mc-link-home" class="button home">Home</a></li>
	               <li><a href="#" id="mc-link-search" class="button search">Search</a></li>
	               <li><a href="#" id="mc-link-scan" class="button scan">Scan</a></li>
	               <li><a href="#" id="mc-link-survey" class="button quiz">Quiz</a></li>
	               <li><a href="#" id="mc-link-account" class="button account">Account</a></li>
	           </ul>
	       </nav>
	   </footer>
	   
	   <div class="spinner">
       </div>
        
        
        <script type="text/javascript">
            app.initialize();
            document.addEventListener("deviceready", onDeviceReady, false);
            
            // variable to hold the current stances on beliefs
            var myStances = new MCBeliefs();
            myStances.load();
            var isSearchOpen = false;
            
            /**
             *  Handle setup when the device is ready.
             */
            function onDeviceReady(){
                // load the currently saved results
                myStances.load();
            }
            
            //////////////////////////////////////////////
            // Controller
            //////////////////////////////////////////////
            var viewIds = ["mc-container-home",
                               "mc-container-quiz",
                               "mc-container-summary",
                               "mc-container-login",
                               "mc-container-detail",
                               "mc-container-settings",
                          ];
            
            /**
             *  Is a view Id valid?
             *  
             *  string -> boolean
             */
            function isViewIdValid(viewIdToTest){
                for(var i=0; i<viewIds.length; i++){
                    if(viewIds[i]==viewIdToTest) return true;
                }
                //alert(viewIdToTest);
                return false;
            }
                           
            /**
             *  Switches to a view.
             *  
             *  TODO: program this properly and more efficiently!
             *  
             *  string -> void
             */
            function switchToView(viewIdToSwitchTo){
                //alert(viewIdToSwitchTo);
                if(!isViewIdValid(viewIdToSwitchTo)) return;
               
                // show relevent view
                $("#"+viewIdToSwitchTo).show();
                $("body").addClass(viewIdToSwitchTo);
                
                // hide all others
                for(var i=0; i<viewIds.length; i++){
                    if(viewIds[i]!=viewIdToSwitchTo){
                        $("#"+viewIds[i]).hide();
                        $("body").removeClass(viewIds[i]);
                    }
                }
                
                // special case for quiz
                if(viewIdToSwitchTo == "mc-container-quiz"){
                    $('#mc-quiz-list').html(quizView.produceQuizHtml());
                }
                
            }
            
            /**
             *  Opens the search dialogue.
             *  
             *  Adds the search-open class to the body.
             *  
             *  void -> void
             */
            function searchOpen(){
                $("body").addClass("search-open");
                isSearchOpen = true;
            }
            
            /**
             *  Closes the search dialogue.
             *  
             *  Removes the search-open class from the body.
             *  
             *  void -> void
             */
            function searchClose(){
                $("body").removeClass("search-open");
                isSearchOpen = false;
            }
            
            /**
             *  Toggles the search dialogue.
             *  
             *  void -> void
             */
            function toggleSearch(){
                if(isSearchOpen){
                    searchClose();
                }else{
                    searchOpen();
                }
            }
            
            function mcShowSpinner(){
                $('.spinner').show();
            }
            
            function mcHideSpinner(){
                $('.spinner').hide();
            }
            
            function mcSetTestStances(isSWknd){
                var result;
                
                if(isSWknd){
                    result =
                        '<ul>'+
                        '<li class="agree">Awesomeness</li>'+
                        '<li class="agree">Fun</li>'+
                        '<li class="agree">Startups</li>'+
                        '<li class="agree">More awesomeness</li>'+
                        '</ul>';
                }else{
                    result =
                    '<ul>'+
                        '<li class="agree">Same-Sex marriage</li>'+
                        '<li class="agree">Testing on animals</li>'+
                        '<li class="agree">Use of child labour</li>'+
                        '<li class="disagree">Government-set minimum wage</li>'+
                    '</ul>';
                }
                
                $('#mc-cause-list').html(result);
            }
            

            // home search scan survey setting
            
            // JQuery rigging

            
            
            $("#mc-link-home").click(function(){
                switchToView("mc-container-home");
            });
            
            $("#mc-link-search").click(function(){
                toggleSearch();
            });
            
            $("#mc-link-scan").click(function() {
                mcShowSpinner();
                MCApp.scanBarcode();
            });
            
            $("#mc-link-survey").click(function(){
                switchToView("mc-container-quiz");
            });
            
            $("#mc-link-account").click(function(){
                switchToView("mc-container-settings");
            });
            
            $("#mc-button-home-scan").click(function(){
                mcShowSpinner();
                MCApp.scanBarcode();
            });
            
            $("#mc-button-home-quiz").click(function(){
                switchToView("mc-container-quiz");
            })
            
            $("#mc-button-home-search").click(function(){
                toggleSearch();
            })
            
            $('#mc-container-summary .card').click(function(){
               $(this).toggleClass("open"); 
            });

$('#search_submit').click(function(){
    var query = $('#search_text').val();
    MCApp.handleUpdateAfterCompanyFound(query);
    });
            
            
            // Summary view controller
            var summaryView = new MCSummaryViewController();
            
            MCApp.handleUpdateAfterCompanyFound = function(companyName){
                summaryView.setCompanyName(companyName);
                
                if (companyName == false) {
                    summaryView.setCompanyName('unknown');
                    summaryView.setPercentAgree(0);
                    summaryView.setPercentUsersAgree(0);
                    mcSetTestStances(false);
                }else if(companyName.toLowerCase() == "startup weekend"){
                    summaryView.setPercentAgree(100);
                    summaryView.setPercentUsersAgree(100);
                    mcSetTestStances(true);
                }else if(companyName == "Sun-Rype Products" && MCApp.isDebug()){
                    summaryView.setPercentAgree(75);
                    mcSetTestStances(false);
                }else{
                    var barcode = MCApp.getCurrentBarcode();
                    //alert(barcode);
                    var testGen = new MCTest();
                    var testVector = testGen.getTestStancesFromBarcode(barcode);
                    var numAgree = myStances.getNumAgreeToArrayOfCompanyStances(testVector);
                    var denom = summaryView.getNumOfCausesThatCount(myStances.getStances(), testVector);
                    if(denom != 0){
                        summaryView.setPercentAgree(numAgree/denom*100);
                    }else{
                        summaryView.setPercentAgree(50);
                    }
                    
                    summaryView.setPercentUsersAgree(50);
                    $('#mc-cause-list').html(
                        summaryView.getDetailedListHtml(myStances.getStances(), testVector)
                    );
                    //mcSetTestStances(false);
                }
                summaryView.updateView();
                mcHideSpinner();
                switchToView("mc-container-summary");
            }
            
            MCApp.handleScannerCancelOrFail = function(){
                mcHideSpinner();
            }
            
            function debugToggleAndShowSummary(){
                summaryView.setPercentAgree(Math.random()<.5?Math.random()*100:50);
                summaryView.updateView();
                switchToView("mc-container-summary");
            }
            
            
           // Quiz view controller
           var quizView = new MCQuizViewController();
           
           $('#mc-quiz-list').html(quizView.produceQuizHtml());
           $('input')
            
           mcHideSpinner();
           switchToView("mc-container-home");
            
        </script>
    </body>
</html>
